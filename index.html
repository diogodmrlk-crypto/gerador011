<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Admin - Keys</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#0b0b0d;
  --panel:#141417;
  --accent:#5865F2;
  --danger:#ef4444;
  --ok:#22c55e;
  --text:#f8fafc;
  --muted:#9ca3af;
  --mono:ui-monospace, monospace;
}
*{box-sizing:border-box}
body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:var(--bg);
  color:var(--text);
  font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;
}
.panel{
  width:100%;
  max-width:720px;
  background:var(--panel);
  padding:20px;
  border-radius:14px;
  box-shadow:0 10px 40px rgba(0,0,0,.6);
}
h1{text-align:center;color:#ef4444;margin:0 0 15px}
.tabs{display:flex;gap:6px;margin-bottom:15px}
.tab{
  flex:1;
  padding:10px;
  border-radius:10px;
  background:#1f1f25;
  text-align:center;
  cursor:pointer;
  font-weight:600;
}
.tab.active{background:var(--accent)}
.section{display:none}
.section.active{display:block}
label{font-size:13px;color:var(--muted);display:block;margin-top:10px}
input,select,button{
  width:100%;
  padding:10px;
  border:none;
  border-radius:10px;
  margin-top:4px;
  background:#1f1f25;
  color:#fff;
}
button{background:var(--accent);font-weight:700;cursor:pointer;margin-top:12px}
button.danger{background:var(--danger)}
button.ok{background:var(--ok)}
pre{
  background:#0f1115;
  padding:10px;
  border-radius:10px;
  font-family:var(--mono);
  max-height:200px;
  overflow:auto;
  margin-top:10px;
  font-size:13px;
}
.keyItem{
  background:#0f1115;
  border-radius:10px;
  padding:10px;
  margin-top:8px;
  font-size:13px;
}
.keyActions{
  display:flex;
  gap:6px;
  margin-top:6px;
}
.keyActions button{flex:1;font-size:12px}
.hide{display:none}
</style>
</head>

<body>

<div class="panel">

<h1>Painel Admin - Keys</h1>

<div class="tabs">
  <div class="tab active" onclick="openTab(0)">ðŸ”‘ Gerar</div>
  <div class="tab" onclick="openTab(1)">ðŸ“‹ Listar</div>
  <div class="tab" onclick="openTab(2)">âš  Gerenciar</div>
</div>

<!-- GERAR -->
<div class="section active">
  <label>Prefixo (com tipo)</label>
  <input id="prefix" value="FERRAO-daily-">

  <label>Quantidade</label>
  <input id="qty" type="number" value="5">

  <label>Tipo</label>
  <select id="type">
    <option value="daily">Daily</option>
    <option value="weekly">Weekly</option>
    <option value="perm">Perm</option>
  </select>

  <label>MockAPI URL</label>
  <input id="api" value="https://69599c6e950475ada464ce41.mockapi.io/api/v1/011k">

  <button onclick="generate()">Gerar Keys</button>
  <pre id="genOut">---</pre>
</div>

<!-- LISTAR -->
<div class="section">
  <button onclick="loadKeys()">Atualizar Lista</button>
  <div id="list"></div>
</div>

<!-- GERENCIAR -->
<div class="section">
  <label>Key exata</label>
  <input id="manageKey" placeholder="Cole a key">

  <button class="ok" onclick="resetDevice()">Resetar Device</button>
  <button class="danger" onclick="revokeKey()">Revogar Key</button>
  <button class="danger" onclick="deleteKey()">Deletar Key</button>

  <pre id="manageOut">---</pre>
</div>

</div>

<script>
const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
const apiInput=document.getElementById("api");

function openTab(i){
  document.querySelectorAll(".tab").forEach((t,x)=>t.classList.toggle("active",x===i));
  document.querySelectorAll(".section").forEach((s,x)=>s.classList.toggle("active",x===i));
}

function rand(len){
  let s="";for(let i=0;i<len;i++)s+=chars[Math.floor(Math.random()*chars.length)];
  return s;
}

async function generate(){
  const api=apiInput.value;
  genOut.textContent="";
  for(let i=0;i<qty.value;i++){
    const key=prefix.value+rand(8)+(Math.floor(Math.random()*9000)+1000);
    const payload={
      key:key,
      used:false,
      device:"",
      type:type.value,
      createdAt:Math.floor(Date.now()/1000),
      activatedAt:0
    };
    await fetch(api,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
    genOut.textContent+=key+"\n";
  }
}

async function loadKeys(){
  list.innerHTML="";
  const res=await fetch(apiInput.value);
  const data=await res.json();
  data.forEach(k=>{
    const div=document.createElement("div");
    div.className="keyItem";
    div.innerHTML=`
      <b>${k.key}</b><br>
      Tipo: ${k.type} | Usada: ${k.used}<br>
      Device: ${k.device || "â€”"}
    `;
    list.appendChild(div);
  });
}

async function findKey(){
  const res=await fetch(apiInput.value);
  const data=await res.json();
  return data.find(k=>k.key===manageKey.value);
}

async function resetDevice(){
  const k=await findKey();
  if(!k)return manageOut.textContent="Key nÃ£o encontrada";
  await fetch(apiInput.value+"/"+k.id,{
    method:"PUT",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({used:false,device:"",activatedAt:0})
  });
  manageOut.textContent="Device resetado";
}

async function revokeKey(){
  const k=await findKey();
  if(!k)return manageOut.textContent="Key nÃ£o encontrada";
  await fetch(apiInput.value+"/"+k.id,{
    method:"PUT",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({used:true,activatedAt:1})
  });
  manageOut.textContent="Key revogada";
}

async function deleteKey(){
  const k=await findKey();
  if(!k)return manageOut.textContent="Key nÃ£o encontrada";
  await fetch(apiInput.value+"/"+k.id,{method:"DELETE"});
  manageOut.textContent="Key deletada";
}
</script>

</body>
</html>
